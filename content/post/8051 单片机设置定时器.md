---
title: 8051 单片机设置定时器
---
定时器有计数脉冲和定时两种模式，这篇文章写的是使用定时器0的16位定时器编写 1s 定时的程序过程。
#### 定时器是如何定时的
首先单片机是根据晶振发出的脉冲进行工作的，比如一个 stc 单片机使用了 12MHz 的外部晶振，这个晶振每秒会发出 12M = 12000000 个脉冲供单片机运行使用。反过来算一下，一个脉冲持续多少时间呢？ 1/12000000 s= 1/12 us。 那么如果我们要定时 1us ，只需要计数 12 个脉冲。 
#### 设置定时器
我们了解到定时 1us ，需要计数 12 个脉冲(12M 晶振的情况下)。 那么定时 1ms ，需要计数  12000 个脉冲。 
首先要开启总中断使能和定时器0使能
```c
#include "stc12c5a60s2.h"
#define FOSC 12000000L
sbit P2_0 = P2^0;

int main()
{
	// 开启总中断和定时器0中断
	EA = 1;
	ET0 = 1;
	// 设置定时器0工作在16位定时器模式
	TMOD = 0x01;
	// 1ms 定时	
	TH0 = (65536 - FOSC/12/1000)/256;
	TL0 = (65536 - FOSC/12/1000)%256;
	// 定时器计时开始
	TR0 = 1;
	while(1);
}	

void Timer0_Rountine(void) interrupt 1
{
	// 重装载定时器
	TH0 = (65536 - FOSC/12/1000)/256;
	TL0 = (65536 - FOSC/12/1000)%256;
	// 你要执行的任务，每1ms 执行一次
	// 任务代码
}

```